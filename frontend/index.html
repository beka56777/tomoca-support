<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tomoca IT Support</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root {
        --primary: #8B4513;
        --primary-dark: #5D4037;
        --primary-light: #D2691E;
        --text: #333;
        --text-light: #666;
        --white: #fff;
        --success: #28a745;
        --error: #dc3545;
        --shadow: 0 4px 12px rgba(139,69,19,0.15);
        --transition: all 0.3s ease;
    }

    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: var(--text); min-height: 100vh; padding: 20px; }

    .container { max-width: 700px; margin: 0 auto; background: var(--white); border-radius: 20px; box-shadow: var(--shadow); overflow: hidden; animation: fadeIn 0.8s ease-out; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }

    .header { background: linear-gradient(135deg, var(--primary-dark), var(--primary)); color: var(--white); padding: 40px 30px; text-align: center; position: relative; }
    .logo { display:flex; align-items:center; justify-content:center; margin-bottom:15px; }
    .logo-icon { font-size:2.5rem; color:var(--white); }
    .header h1 { font-size:2.5rem; margin-bottom:10px; font-weight:700; }
    .header p { font-size:1.2rem; opacity:0.9; max-width:500px; margin:0 auto; }

    .form-container { padding:40px 30px; background: var(--white); }
    .form-group { margin-bottom:25px; position: relative; }
    label { display:flex; align-items:center; gap:8px; font-weight:600; color:var(--primary-dark); margin-bottom:10px; }
    label i { color: var(--primary-light); }
    .input-wrapper { position: relative; }
    input, select, textarea { width:100%; padding:15px 20px; border:2px solid #e0e0e0; border-radius:12px; font-size:16px; transition: var(--transition); font-family:inherit; }
    input:focus, select:focus, textarea:focus { outline:none; border-color:var(--primary); box-shadow:0 0 0 3px rgba(139,69,19,0.1); }
    textarea { resize: vertical; min-height:140px; line-height:1.5; }

    .urgency-indicator { display:flex; gap:10px; margin-top:10px; }
    .urgency-option { flex:1; text-align:center; padding:8px; border-radius:8px; background:#f5f5f5; cursor:pointer; transition: var(--transition); font-weight:500; }
    .urgency-option:hover { background:#e0e0e0; }
    .urgency-option.selected { background: var(--primary); color: white; }

    .submit-btn { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: var(--white); padding:18px 30px; border:none; border-radius:12px; font-size:1.2rem; font-weight:600; cursor:pointer; width:100%; display:flex; align-items:center; justify-content:center; gap:10px; box-shadow:0 4px 10px rgba(139,69,19,0.3); transition: var(--transition); }
    .submit-btn:hover { transform:translateY(-2px); box-shadow:0 6px 15px rgba(139,69,19,0.4); }
    .submit-btn:active { transform:translateY(0); }
    .submit-btn:disabled { background:#ccc; cursor:not-allowed; box-shadow:none; transform:none; }

    .loading { display:none; text-align:center; margin:20px 0; flex-direction: column; align-items: center; gap:15px; }
    .spinner { border:4px solid rgba(139,69,19,0.2); border-top:4px solid var(--primary); border-radius:50%; width:50px; height:50px; animation: spin 1s linear infinite; }
    @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

    .response-message { display:none; margin-top:25px; padding:20px; border-radius:12px; text-align:center; font-weight:600; animation: slideIn 0.5s ease-out; }
    @keyframes slideIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
    .success { background:#e8f5e9; color:var(--success); border:1px solid #c8e6c9; }
    .error { background:#ffebee; color:var(--error); border:1px solid #ffcdd2; }

    .ticket-id { display:inline-block; background:rgba(139,69,19,0.1); padding:8px 15px; border-radius:8px; margin:10px 0; font-family:monospace; font-size:1.1rem; color:var(--primary-dark); }

    .footer { text-align:center; padding:25px; color:var(--text-light); font-size:0.9rem; border-top:1px solid #f0f0f0; background:#fafafa; }

    .step-indicator { display:flex; justify-content:center; margin-bottom:30px; position:relative; }
    .step { width:30px; height:30px; border-radius:50%; background:#e0e0e0; display:flex; align-items:center; justify-content:center; font-weight:bold; color:var(--text-light); z-index:2; }
    .step.active { background: var(--primary); color:white; }
    .step-line { position:absolute; top:15px; left:15%; right:15%; height:2px; background:#e0e0e0; z-index:1; }

    @media (max-width:600px){
        .container { border-radius:15px; }
        .header { padding:30px 20px; }
        .header h1 { font-size:2rem; }
        .form-container { padding:30px 20px; }
        .urgency-indicator { flex-direction: column; }
    }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="logo"><i class="fas fa-mug-hot logo-icon"></i></div>
        <h1>Tomoca IT Support</h1>
        <p>Get technical assistance quickly and efficiently</p>
    </div>

    <div class="form-container">
        <div class="step-indicator">
            <div class="step-line"></div>
            <div class="step active">1</div>
        </div>

        <form id="supportForm">
            <div class="form-group">
                <label for="name"><i class="fas fa-user"></i> Your Name</label>
                <div class="input-wrapper">
                    <input type="text" id="name" name="name" required placeholder="Enter your full name">
                </div>
            </div>

            <div class="form-group">
                <label for="department"><i class="fas fa-building"></i> Department</label>
                <div class="input-wrapper">
                    <select id="department" name="department" required>
                        <option value="">Select your department</option>
                        <option value="HR">Human Resources</option>
                        <option value="Finance">Finance</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Operations">Operations</option>
                        <option value="Sales">Sales</option>
                        <option value="Coffee Production">Coffee Production</option>
                        <option value="Retail">Retail</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="urgency"><i class="fas fa-exclamation-circle"></i> Urgency Level</label>
                <div class="input-wrapper">
                    <select id="urgency" name="urgency" required>
                        <option value="">Select urgency level</option>
                        <option value="Low">Low - Can wait a few days</option>
                        <option value="Medium">Medium - Need help today</option>
                        <option value="High">High - Urgent, affecting work</option>
                        <option value="Critical">Critical - System down!</option>
                    </select>
                </div>
                <div class="urgency-indicator">
                    <div class="urgency-option" data-value="Low">Low</div>
                    <div class="urgency-option" data-value="Medium">Medium</div>
                    <div class="urgency-option" data-value="High">High</div>
                    <div class="urgency-option" data-value="Critical">Critical</div>
                </div>
            </div>

            <div class="form-group">
                <label for="issue"><i class="fas fa-clipboard-list"></i> Issue Description</label>
                <div class="input-wrapper">
                    <textarea id="issue" name="issue" required placeholder="Please describe your issue in detail..."></textarea>
                </div>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">
                <i class="fas fa-paper-plane"></i> Submit Ticket
            </button>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Submitting your ticket to the IT team...</p>
            </div>

            <div class="response-message" id="responseMessage"></div>
        </form>
    </div>

    <div class="footer">
        <p>Tomoca Coffee IT Department | Support System v2.0</p>
    </div>
</div>

<script>
document.getElementById('supportForm').addEventListener('submit', async function(e){
    e.preventDefault();

    const submitBtn = document.getElementById('submitBtn');
    const loading = document.getElementById('loading');
    const responseMessage = document.getElementById('responseMessage');

    const formData = {
        name: document.getElementById('name').value.trim(),
        department: document.getElementById('department').value,
        urgency: document.getElementById('urgency').value,
        issue: document.getElementById('issue').value.trim()
    };

    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';
    loading.style.display = 'flex';
    responseMessage.style.display = 'none';

    try {
        // ✅ Updated for Vercel serverless function
        const response = await fetch('/AAPI/submit-ticket', {
            method:'POST',
            headers:{ 'Content-Type':'application/json' },
            body: JSON.stringify(formData)
        });

        const data = await response.json();
        responseMessage.style.display = 'block';

        if(data.success){
            responseMessage.className = 'response-message success';
            responseMessage.innerHTML = `
                ✅ <strong>Ticket Submitted Successfully!</strong><br>
                <span class="ticket-id">Ticket ID: ${data.ticketId}</span><br>
                <small>The IT team has been notified and will contact you shortly.</small>
            `;
            document.getElementById('supportForm').reset();
        } else {
            responseMessage.className = 'response-message error';
            responseMessage.textContent = `❌ ${data.message}`;
        }

    } catch(error){
        console.error('Error:', error);
        responseMessage.style.display='block';
        responseMessage.className='response-message error';
        responseMessage.textContent='❌ Network error. Please try again later.';
    } finally {
        submitBtn.disabled=false;
        submitBtn.innerHTML='<i class="fas fa-paper-plane"></i> Submit Ticket';
        loading.style.display='none';
    }
});

// Urgency buttons functionality
document.querySelectorAll('.urgency-option').forEach(option => {
    option.addEventListener('click', () => {
        document.getElementById('urgency').value = option.dataset.value;
        document.querySelectorAll('.urgency-option').forEach(o => o.classList.remove('selected'));
        option.classList.add('selected');
    });
});
</script>
</body>
</html>
